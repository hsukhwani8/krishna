<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Krishna Quiz ‚Äì Janmashtami Celebration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&family=Hind:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    body{font-family:'Hind',sans-serif;background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);background-size:400% 400%;animation:gradientBG 15s ease infinite;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem}
    @keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .section{display:none}.section.active{display:block;animation:fadeIn .4s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .modal-backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:40;align-items:center;justify-content:center}
    .modal-backdrop.active{display:flex}
    .modal-content{transform:scale(.92);opacity:0;transition:all .25s}.modal-backdrop.active .modal-content{transform:scale(1);opacity:1}
    #offlineBanner{display:none}#offlineBanner.active{display:block}
    .firework{position:absolute;width:10px;height:10px;border-radius:50%;animation:fireworks 1s ease-out forwards;pointer-events:none}
    @keyframes fireworks{0%{transform:scale(0);opacity:1}100%{transform:scale(3);opacity:0}}
  </style>
</head>
<body>
  <div id="app-container" class="w-full max-w-md mx-auto bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl overflow-hidden relative">
    <header class="p-6 bg-gradient-to-r from-orange-500 to-yellow-400 text-white text-center shadow-md">
      <div class="h-24 flex items-center justify-center mb-2">
        <img id="headerImg" src="https://png.pngtree.com/png-clipart/20250228/original/pngtree-cute-krishna-eating-makhan-png-image_20530500.png" alt="Krishna illustration" class="h-24"
             onerror="this.style.display='none';document.getElementById('headerImgFallback').style.display='block';">
        <div id="headerImgFallback" style="display:none" class="text-4xl">ü™∑ü¶ö</div>
      </div>
      <h1 class="text-4xl font-bold" style="font-family:'Teko',sans-serif">KRISHNA QUIZ</h1>
      <p class="font-light">Janmashtami Celebration 2025</p>
      <p class="font-semibold text-sm mt-1">ISKCON</p>
    </header>

    <div id="offlineBanner" class="px-4 py-2 text-sm bg-amber-100 text-amber-900 border-b border-amber-300">
      You‚Äôre <strong>offline</strong> ‚Äî logging locally. Data syncs when back online.
    </div>

    <main class="p-6">
      <!-- Contact details -->
      <div id="userSection" class="section active">
        <h2 class="text-3xl font-semibold text-center text-gray-800 mb-4">Welcome!</h2>
        <p class="text-center text-gray-600 mb-6">Enter your details to begin.</p>
        <div class="space-y-4">
          <input id="fullName" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" placeholder="Full Name">
          <input id="mobileNumber" type="tel" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" placeholder="Mobile (e.g. 0412 345 678)">
          <button id="nextBtn" class="w-full bg-orange-500 text-white font-bold py-3 rounded-lg hover:bg-orange-600 transition-transform transform hover:scale-105 shadow-lg">Next</button>
        </div>
        <button id="adminBtn" class="mt-4 w-full text-xs text-gray-400 hover:text-orange-500">Admin Login</button>
      </div>

      <!-- Avatar select page -->
      <div id="avatarSection" class="section">
        <h2 class="text-3xl font-semibold text-center text-gray-800 mb-2">Choose your Avatar</h2>
        <p class="text-center text-gray-600 mb-4">Select one of the Dashavatara to answer from.</p>
        <div id="avatarList" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
      </div>

      <!-- Quiz -->
      <div id="quizSection" class="section">
        <div class="flex justify-between items-center mb-4">
          <div>
            <h2 class="text-3xl font-semibold text-gray-800">The Quiz</h2>
            <p id="selectedAvatarDisplay" class="text-orange-600 font-semibold"></p>
          </div>
          <div id="streak-tracker" class="flex gap-2">
            <i class="fa-solid fa-feather-pointed text-gray-300 text-2xl"></i>
            <i class="fa-solid fa-feather-pointed text-gray-300 text-2xl"></i>
            <i class="fa-solid fa-feather-pointed text-gray-300 text-2xl"></i>
          </div>
        </div>
        <div class="bg-gray-100 p-4 rounded-lg shadow-inner mb-6">
          <p class="text-center text-gray-700 mb-3">Spin the wheel. Enter the question number you get.</p>
          <div class="flex gap-2">
            <input type="number" id="questionNumberInput" min="1" max="10" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" placeholder="Enter Q# (1‚Äì10)">
            <button id="showQuestionBtn" class="bg-orange-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-600"><i class="fa-solid fa-paper-plane"></i></button>
          </div>
        </div>
        <div id="questionArea" class="mt-6"></div>
      </div>

      <!-- Admin -->
      <div id="adminSection" class="section">
        <h2 class="text-3xl font-semibold text-center text-gray-800 mb-4">üìã Admin Panel</h2>
        <button id="downloadBtn" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg hover:bg-blue-600 shadow-lg mb-4">‚¨áÔ∏è Download Results CSV</button>
        <div id="resultTableContainer" class="text-sm overflow-x-auto"></div>
      </div>
    </main>
  </div>

  <!-- Generic modal -->
  <div id="customModal" class="modal-backdrop">
    <div class="modal-content bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl text-center">
      <div id="modalIcon" class="text-5xl mb-4"></div>
      <h3 id="modalTitle" class="text-2xl font-bold text-gray-800 mb-2"></h3>
      <p id="modalMessage" class="text-gray-600 mb-6"></p>
      <div id="modalInputContainer" class="mb-4 hidden">
        <input id="modalInput" type="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" placeholder="Enter Password">
      </div>
      <div id="modalActions" class="flex gap-3 justify-center"></div>
    </div>
  </div>

  <!-- Avatar Picker Modal -->
  <div id="avatarModal" class="modal-backdrop">
    <div class="modal-content bg-white w-full max-w-md p-6 rounded-2xl shadow-xl">
      <h3 class="text-2xl font-bold text-gray-800 mb-2 text-center">Choose your Avatar</h3>
      <p class="text-gray-600 mb-4 text-center">Great job! Pick the avatar for your next question.</p>
      <div id="avatarModalList" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
      <div class="mt-4 text-center">
        <button id="closeAvatarBtn" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">Close</button>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       GOOGLE SHEETS ENDPOINT
       ========================= */
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyD6r-A-9I2chujfjhQQrAwawGYpA2ppg47pNTPRIZ0-z8q8g5Wjq7BXUtnEKVU7sjgeQ/exec";

    /* ======= UI HELPERS ======= */
    const offlineBanner = document.getElementById('offlineBanner');
    function setOfflineBanner(on){ offlineBanner.classList.toggle('active', !!on); }
    function showSection(id){ document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.getElementById(id)?.classList.add('active'); }
    function showModal(type,title,message,buttons=[]){
      const m=document.getElementById('customModal');
      document.getElementById('modalIcon').innerHTML={
        success:'<i class="fa-solid fa-circle-check text-green-500"></i>',
        error:'<i class="fa-solid fa-circle-xmark text-red-500"></i>',
        win:'<i class="fa-solid fa-trophy text-yellow-500"></i>',
        loss:'<i class="fa-solid fa-heart-crack text-gray-500"></i>',
        prompt:'<i class="fa-solid fa-key text-blue-500"></i>'
      }[type]||'';
      document.getElementById('modalTitle').innerText=title;
      document.getElementById('modalMessage').innerText=message;
      const actions=document.getElementById('modalActions'); actions.innerHTML='';
      const inputContainer=document.getElementById('modalInputContainer'); inputContainer.style.display=type==='prompt'?'block':'none';
      if(type==='prompt') document.getElementById('modalInput').value='';
      (buttons||[]).forEach(bi=>{
        const el=bi.isLink?Object.assign(document.createElement('a'),{href:bi.href,target:'_blank',rel:'noopener noreferrer'}):document.createElement('button');
        el.innerHTML=bi.text; el.className=`flex-1 text-white font-bold py-2 px-4 rounded-lg transition-all shadow-md ${bi.class||'bg-gray-500 hover:bg-gray-600'}`;
        if(!bi.isLink) el.onclick=()=>{ if(type==='prompt') bi.callback?.(document.getElementById('modalInput').value); else bi.callback?.(); m.classList.remove('active'); };
        actions.append(el);
      });
      m.classList.add('active');
    }
    function openAvatarModal(){ document.getElementById('avatarModal').classList.add('active'); }
    function closeAvatarModal(){ document.getElementById('avatarModal').classList.remove('active'); }
    document.getElementById('closeAvatarBtn').onclick=closeAvatarModal;

    /* ======= GAME DATA ======= */
    const ADMIN_PASSWORD = "gopinath123";
    const AVATARS = [
      { name: "Matsya", icon: "fish" }, { name: "Kurma", icon: "turtle" },
      { name: "Varaha", icon: "hippo" }, { name: "Narasimha", icon: "lion" },
      { name: "Vamana", icon: "child-reaching" }, { name: "Parashurama", icon: "gavel" },
      { name: "Rama", icon: "bullseye" }, { name: "Krishna", icon: "feather-pointed" },
      { name: "Buddha", icon: "om" }, { name: "Kalki", icon: "horse" }
    ];

    const RAW_QUESTIONS = {/* ‚Äî‚Äî‚Äî truncated in this message to save space ‚Äî‚Äî‚Äî
      Use the exact RAW_QUESTIONS block you already have (11 through 1010). */};
    // Build QUESTION_BANK
    const QUESTION_BANK = {}; for (let i=1;i<=10;i++) QUESTION_BANK[i] = new Array(10).fill(null);
    Object.keys(RAW_QUESTIONS).forEach(k=>{
      const key=k.toString(); const avatarIdx=parseInt(key[0],10); const qNum=parseInt(key.slice(1),10);
      if (avatarIdx>=1 && avatarIdx<=10 && qNum>=1 && qNum<=10) QUESTION_BANK[avatarIdx][qNum-1]=RAW_QUESTIONS[k];
    });

    /* ======= STATE ======= */
    let currentUserName="", currentUserMobile="", selectedAvatarIndex=null, correctStreak=0;
    let allAttempts=[], allWinners=[];
    let correctAnsweredSet = new Set();
    const winSound = new Audio("https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3");

    /* ======= GOOGLE SHEETS LOGGING ======= */
    async function postToSheets(payload){
      // Use no-cors to avoid CORS issues with Apps Script; request still reaches the script.
      try{
        await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        setOfflineBanner(false);
        return true;
      }catch(err){
        console.warn('Sheets post failed; falling back to localStorage', err);
        setOfflineBanner(true);
        return false;
      }
    }
    // Public wrappers used by the game:
    async function saveAttemptDoc(row){
      const ok = await postToSheets({type:'attempt', ...row});
      // Keep a local copy for Admin table either way
      allAttempts=[{...row,id:`loc_${Date.now()}`} , ...allAttempts];
      localStorage.setItem('quiz_attempts', JSON.stringify(allAttempts));
    }
    async function saveWinnerDoc(row){
      const ok = await postToSheets({type:'winner', ...row});
      allWinners=[{...row,id:`loc_${Date.now()}`} , ...allWinners];
      localStorage.setItem('quiz_winners', JSON.stringify(allWinners));
    }

    /* ======= RENDERERS ======= */
    function renderAvatarButtons(){
      const container=document.getElementById('avatarList'); container.innerHTML='';
      AVATARS.forEach((a,idx)=>{
        const card=document.createElement('div');
        card.className='p-4 bg-white rounded-xl shadow-md cursor-pointer text-center hover:shadow-lg hover:bg-yellow-50 hover:-translate-y-1 transition-all';
        card.onclick=()=>selectAvatar(idx);
        card.innerHTML=`<i class="fa-solid fa-${a.icon} text-4xl text-orange-500 mb-2"></i><p class="font-semibold text-gray-700">${a.name}</p>`;
        container.appendChild(card);
      });
    }
    function renderAvatarModal(){
      const container=document.getElementById('avatarModalList'); container.innerHTML='';
      AVATARS.forEach((a,idx)=>{
        const btn=document.createElement('button');
        btn.className='p-3 bg-white border rounded-xl shadow-sm hover:shadow-md hover:bg-yellow-50 transition text-center';
        btn.innerHTML=`<i class="fa-solid fa-${a.icon} text-2xl text-orange-500 mb-1"></i><div class="font-semibold text-gray-700">${a.name}</div>`;
        btn.onclick=()=>{ selectAvatar(idx); closeAvatarModal(); };
        container.appendChild(btn);
      });
    }

    /* ======= FLOW ======= */
    function selectAvatar(idx){
      selectedAvatarIndex = idx + 1;
      document.getElementById('selectedAvatarDisplay').innerText = `Avatar: ${AVATARS[idx].name}`;
      showSection('quizSection');
    }
    function getQuestion(avatarIdx,qNum){ return (QUESTION_BANK[avatarIdx]||[])[qNum-1] || null; }

    function showQuestion(){
      const qn=parseInt(document.getElementById('questionNumberInput').value,10);
      if(isNaN(qn)||qn<1||qn>10){ showModal('error','Invalid Question','Please enter a number between 1 and 10.',[{text:'Okay'}]); return; }
      if(!selectedAvatarIndex){ showModal('error','No Avatar','Please select an avatar first.',[{text:'Choose Avatar', class:'bg-orange-500 hover:bg-orange-600', callback:()=>{ showSection('avatarSection'); }}]); return; }
      const key = `${selectedAvatarIndex}-${qn}`;
      if (correctAnsweredSet.has(key)) { showModal('error','Already Answered','You already cleared this one for this avatar. Pick a different number.',[{text:'Okay'}]); return; }

      const data=getQuestion(selectedAvatarIndex, qn);
      const area=document.getElementById('questionArea');
      if(!data){ area.innerHTML=`<p class="text-center text-red-500 font-semibold">‚ùå Question not set for this avatar/number yet.</p>`; return; }

      let html=`<p class="text-lg font-semibold text-center mb-4">${data.question}</p><div class="space-y-3">`;
      data.options.forEach((opt,i)=>{
        const label=String.fromCharCode(65+i);
        html+=`<button id="ans-${label}" class="w-full text-left p-3 bg-white border-2 border-orange-200 rounded-lg hover:bg-orange-100 hover:border-orange-400 transition-all"
                 data-label="${label}">${label}) ${opt}</button>`;
      });
      html+=`</div>`;
      area.innerHTML=html;

      // attach once
      area.querySelectorAll('button[id^="ans-"]').forEach(btn=>{
        btn.addEventListener('click', ()=>checkAnswer(btn, btn.dataset.label, data.answer, selectedAvatarIndex, qn));
      });
    }

    async function checkAnswer(btn, userAns, correctAns, avatarIdx, qNum){
      document.querySelectorAll('#questionArea button').forEach(b=>b.disabled=true);
      const isCorrect = userAns===correctAns;
      if(isCorrect){
        btn.classList.add('!bg-green-500','text-white','!border-green-700','font-bold'); btn.innerHTML+=' <i class="fa-solid fa-check"></i>';
      } else {
        btn.classList.add('!bg-red-500','text-white','!border-red-700','font-bold'); btn.innerHTML+=' <i class="fa-solid fa-xmark"></i>';
      }

      await saveAttemptDoc({
        name: currentUserName, mobile: currentUserMobile,
        avatar: AVATARS[avatarIdx-1]?.name || '', avatarIndex: avatarIdx,
        questionNumber: qNum, selectedAnswer: userAns, correct: isCorrect,
        timestamp: { seconds: Math.floor(Date.now()/1000) }
      });

      setTimeout(async ()=>{
        if(isCorrect){
          correctAnsweredSet.add(`${avatarIdx}-${qNum}`);
          correctStreak++; updateStreakTracker(correctStreak);
          resetQuestionUI();
          if(correctStreak>=3){ await handleWin(); }
          else { openAvatarModal(); }
        } else {
          correctStreak=0; updateStreakTracker(0);
          showModal('loss','Not quite‚Ä¶','Try another question number.',[{text:'Okay', class:'bg-orange-500 hover:bg-orange-600', callback:()=>{ resetQuestionUI(); }}]);
        }
      },900);
    }

    function updateStreakTracker(streak){
      document.querySelectorAll('#streak-tracker i').forEach((icon,i)=>{
        if(i<streak) icon.classList.replace('text-gray-300','text-yellow-400'); else icon.classList.replace('text-yellow-400','text-gray-300');
      });
    }
    function resetQuestionUI(){ document.getElementById('questionArea').innerHTML=''; document.getElementById('questionNumberInput').value=''; }
    async function handleWin(){
      await saveWinnerDoc({name:currentUserName,mobile:currentUserMobile,timestamp:{seconds:Math.floor(Date.now()/1000)}});
      launchFireworks(); try{ await winSound.play(); }catch{}
      showModal('win','ü™∑ You Won! ü™∑','Hare Krishna! Show this to a youth member for your prize.',[
        { text:'<i class="fa-brands fa-instagram"></i> Follow Us', isLink:true, href:'https://www.instagram.com/iskcon_ns_youth/', class:'bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600' },
        { text:'Play Again', class:'bg-gray-500 hover:bg-gray-600', callback:restartGame }
      ]);
    }
    function restartGame(){
      correctStreak=0; selectedAvatarIndex=null; currentUserName=""; currentUserMobile="";
      correctAnsweredSet = new Set(); document.getElementById('selectedAvatarDisplay').innerText='';
      document.getElementById('fullName').value=''; document.getElementById('mobileNumber').value='';
      resetQuestionUI(); showSection('userSection');
    }

    /* ======= ADMIN ======= */
    function showResultsTable(){
      const c=document.getElementById('resultTableContainer'); let html="";
      if(allAttempts && allAttempts.length){
        html+="<h3 class='text-xl font-bold mb-2 text-gray-700'>Quiz Attempts (local copy)</h3><table class='w-full border-collapse'><thead class='bg-gray-200'><tr><th class='p-2 border'>Name</th><th class='p-2 border'>Mobile</th><th class='p-2 border'>Avatar</th><th class='p-2 border'>AvatarIdx</th><th class='p-2 border'>Q#</th><th class='p-2 border'>Correct</th></tr></thead><tbody>";
        [...allAttempts].forEach(r=>{
          html+=`<tr class='border-b'><td class='p-2 border'>${r.name||''}</td><td class='p-2 border'>${r.mobile||''}</td><td class='p-2 border'>${r.avatar||''}</td><td class='p-2 border'>${r.avatarIndex||''}</td><td class='p-2 border'>${r.questionNumber||''}</td><td class='p-2 border ${r.correct?'text-green-600':'text-red-600'}'>${r.correct?'Yes':'No'}</td></tr>`;
        });
        html+="</tbody></table>";
      }
      if(allWinners && allWinners.length){
        html+="<h3 class='text-xl font-bold mt-6 mb-2 text-gray-700'>üéâ Winners (local copy)</h3><table class='w-full border-collapse'><thead class='bg-gray-200'><tr><th class='p-2 border'>Name</th><th class='p-2 border'>Mobile</th><th class='p-2 border'>Time</th></tr></thead><tbody>";
        [...allWinners].forEach(w=>{
          const time=w.timestamp? new Date((w.timestamp.seconds||Math.floor(Date.now()/1000))*1000).toLocaleString(): 'N/A';
          html+=`<tr class='border-b'><td class='p-2 border'>${w.name||''}</td><td class='p-2 border'>${w.mobile||''}</td><td class='p-2 border'>${time}</td></tr>`;
        });
        html+="</tbody></table>";
      }
      c.innerHTML = html || "<p>No local results yet. (Authoritative data is in the Google Sheet.)</p>";
    }
    function downloadResults(){
      const hasData=(allAttempts?.length||0)+(allWinners?.length||0)>0;
      if(!hasData){ showModal('error','No Data','No local results to download yet.',[{text:'Okay'}]); return; }
      const attemptHeaders=["Name","Mobile","Avatar","AvatarIdx","Q#","Correct","Time"];
      const attemptRows=(allAttempts||[]).map(r=>{
        const time=r.timestamp? new Date((r.timestamp.seconds||Math.floor(Date.now()/1000))*1000).toLocaleString(): 'N/A';
        return [r.name,r.mobile,r.avatar,r.avatarIndex||'',r.questionNumber||'',r.correct?'Yes':'No',time];
      });
      const winnerHeaders=["Name","Mobile","Time"];
      const winnerRows=(allWinners||[]).map(w=>{
        const time=w.timestamp? new Date((w.timestamp.seconds||Math.floor(Date.now()/1000))*1000).toLocaleString(): 'N/A';
        return [w.name,w.mobile,time];
      });
      const csvAttempts=[attemptHeaders,...attemptRows].map(r=>r.map(v=>`"${String(v??'').replace(/"/g,'""')}"`).join(",")).join("\n");
      const csvWinners=[winnerHeaders,...winnerRows].map(r=>r.map(v=>`"${String(v??'').replace(/"/g,'""')}"`).join(",")).join("\n");
      const final="Attempts\n"+csvAttempts+"\n\nWinners\n"+csvWinners;
      const blob=new Blob([final],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='quiz_results_local.csv'; a.click();
    }

    /* ======= UTIL ======= */
    function normaliseAuMobile(input){
      const digits=input.replace(/[^\d+]/g,'');
      const auMobileRegex=/^(?:\+?61|0)4\d{8}$/;
      if(!auMobileRegex.test(digits.replace(/\s/g,''))) return null;
      if(digits.startsWith('0')) return '+61'+digits.slice(1);
      if(digits.startsWith('61')) return '+'+digits;
      return digits;
    }
    function launchFireworks(){
      const c=document.getElementById('app-container'); const rect=c.getBoundingClientRect();
      for(let i=0;i<36;i++){
        const fw=document.createElement('div'); fw.className='firework';
        fw.style.top = `${Math.random()*rect.height}px`; fw.style.left = `${Math.random()*rect.width}px`;
        fw.style.background = `hsl(${Math.random()*360},100%,60%)`; fw.style.zIndex=50;
        c.appendChild(fw); setTimeout(()=>fw.remove(),1000);
      }
    }

    /* ======= WIRING ======= */
    document.getElementById('nextBtn').onclick = ()=>{
      const name=document.getElementById('fullName').value.trim();
      const mobileRaw=document.getElementById('mobileNumber').value.trim();
      if(!name||!mobileRaw){ showModal('error','Incomplete Details','Please enter both your name and mobile number.',[{text:'Okay'}]); return; }
      const normalised=normaliseAuMobile(mobileRaw);
      if(!normalised){ showModal('error','Invalid Number','Please enter a valid Australian mobile (04XXXXXXXX or +614XXXXXXXX).',[{text:'Okay'}]); return; }
      currentUserName=name; currentUserMobile=normalised;
      showSection('avatarSection');
    };
    document.getElementById('adminBtn').onclick = ()=>{
      showModal('prompt','Admin Access','Enter the admin password.',[
        { text:'Login', class:'bg-blue-500 hover:bg-blue-600', callback:pwd=>{
          if(pwd===ADMIN_PASSWORD){ showResultsTable(); showSection('adminSection'); }
          else{ showModal('error','Access Denied','Incorrect password.',[{text:'Okay'}]); }
        }}
      ]);
    };
    document.getElementById('showQuestionBtn').onclick = showQuestion;
    document.getElementById('downloadBtn').onclick = downloadResults;

    // Boot
    (function init(){
      // restore local copies so Admin has something before any new plays
      try{
        allAttempts=JSON.parse(localStorage.getItem('quiz_attempts')||'[]');
        allWinners=JSON.parse(localStorage.getItem('quiz_winners')||'[]');
      }catch{}
      renderAvatarButtons(); renderAvatarModal();
      setOfflineBanner(!navigator.onLine);
      window.addEventListener('online', ()=>setOfflineBanner(false));
      window.addEventListener('offline', ()=>setOfflineBanner(true));
    })();
  </script>
</body>
</html>
